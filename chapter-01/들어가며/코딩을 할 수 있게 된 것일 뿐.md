# 1장 - 들어가며

## 커넥션 풀 설정의 중요성

신입 개발자들이 자주 겪는 문제를 가상의 사례를 통해 알아보자.

### 상황 1) 개발 주소에 접근하니 **DB에 연결할 수 없다**는 오류 발생

- 개발 DB엔 이상이 없고 DB 연결도 잘 되는 상태
- 개발 서버를 재시작해도, 잠시 동안만 제대로 실행되고 그 이후에는 다시 오류 발생

### 원인) DB 커넥션을 닫지 않았음

- 일부 코드에서 **사용이 끝난 DB 커넥션을 닫지 않아서** 발생한 문제

```java
// 문제의 코드
Connection conn = ds.getConnection(); // 커넥션 풀에서 구함
try {

} catch(Exception e) {
	... 에러 처리
}
// conn.close()가 누락 -> 커넥션 풀에 반환하지 않음
```

- DB 커넥션을 사용한 뒤 풀에 반환하지 않았고, 이로 인해 커넥션이 누수
- → 결국 풀에 있던 모든 커넥션이 소진
- → 이때부터 풀에서 새로운 커넥션을 가져올 수 없는 오류가 발생한 것

커넥션 누수가 발생하는 버그를 모두 찾아 수정하고 개발 서버에 배포, 테스트 요청 후 퇴근!!!

### 상황 2) 다음날 또 다시 DB에 연결할 수 없다는 오류 재발생

### 원인) 커넥션의 최대 연결 시간 설정이 없음

- Q. 최대 연결 시간이 없는게 어떤 문제죠?
- A. DBMS 자체적으로 커넥션 유지 시간이 설정되어 있는데, 풀에 있는 커넥션의 연결 시간이 DBMS의 설정 시간을 초과하면서 발생한 문제임
- 이후 커넥션 풀의 커넥션 최대 유지 시간을 알맞게 설정한 후 다시 개발 서버에 배포 → 마침내 시간이 지나도 DB 연결이 안 되는 문제가 발생하지 않음


스프링과 같은 프레임워크를 사용하면서 커넥션을 반환하지 않는 문제는 줄었지만, **커넥션 풀을 잘못 설정해서 DB 연결이 제대로 되지 않는 문제**는 지금도 초보 백엔드 개발자들이 자주 겪는 문제다. 초보 개발자가 몰라서 저지르는 실수는 이 뿐만이 아니다. 

- 보안에 매우 취약한 코드를 작성하거나,
- 처음에는 잘 동작하지만 시간이 지나면서 급격히 느려지는 시스템을 만들기도 함

스프링부트, Node.js 등을 사용해 API 서버를 만드는 방법을 익혔다 하더라도! 이건 서버 개발자가 알아야 할 지식의 일부에 지나지 않는다.

### 결론
⇒ 즉, 서버 개발을 위해 알아야 할 다양한 기초 지식을 모르면 실제 서비스 운영 과정에서 여러 문제가 발생할 수 있음을 알아야 함
