# 서버 성능 개선 기초

서버 관점에서 처리량과 응답 시간을 개선하는 방법을 중심으로 살펴보자.

## 병목 지점

트래픽이 증가하면서 **성능 문제가 발생하는 주된 이유?**

- **시스템이 수용할 수 있는 최대 TPS를 초과하는 트래픽이 유입**되기 때문
- 즉, 증가하는 트래픽을 적절히 처리하려면 시스템이 제공할 수 있는 TPS를 높여야 함.

**TPS를 높이려면** 어떻게 해야할까?

- 먼저 성능 문제가 발생하는 지점을 찾아야 한다.
- = **처리 시간이 오래 걸리는 작업을 찾자!**
    - 모니터링 도구를 사용해 실제 실행 시간을 측정하는 것이 제일 좋은 방법.
    - 적절한 모니터링 도구가 없다면 **로그라도 남기자.**
    - 의심되는 코드의 실행 시간을 로그로 남겨두면 나중에 성능 문제가 다시 발생했을 때 개선할 부분을 찾는데 도움이 됨
- 저자의 경험 상 성능 문제는 주로 DB나 외부 API를 연동하는 과정에서 발생했다고 함.

<br>

## 수직 확장과 수평 확장

성능 문제를 해결하기 위해 아무리 적절한 개선 방안을 찾았다고 해도, 시간이 오래 걸리는 방법이라면 일단 시도를 미루자. 그것보단 **빠르게 적용할 수 있는 개선안을 찾아 적용**하는 것이 제일 중요하다.

>
> 급한 불을 먼저 끄고 나서 근본적인 해결책을 모색하자는 말!
> 사용자가 서비스를 이용하지 못하는 상황에서 이를 방치한 채 시간만 오래 걸리는 개선 방안을 시도할 순 없음.
> 

<br>

Q. **급한 불을 끄는 방법**

A. **수직 확장**하기. 

<br>

- **수직 확장 (scale-up)**
    - CPU, 메모리, 디스크 등의 자원을 증가시키는 것을 말함
    - 더 빠른 CPU로 바꾸거나 CPU 코어 수를 늘리고, 메모리를 확장하고 디스크를 SSD로 바꾸는 것만으로도 성능이 개선될 수 있음
    - **클라우드 환경**에서 비교적 빠르게 시도할 수 있는 방법임
- 수직 확장이 DB에서만 효과가 있는 것은 아님
    - **서버도 메모리 부족으로 성능 문제가 발생할 수 있음.**
        - `e.g.` 서버 메모리가 **512MB**일 때, 동시에 처리할 수 있는 요청 개수가 200개라고 가정하자.
        - 여기서 동시 요청이 250개로 늘어나는 것만으로도 응답 시간이 증가하기 시작함.
        - 이 때 **서버 메모리를 1GB로 증설하기만 해도** TPS를 늘릴 수 있음
- 수직 확장은 즉각적인 효과를 바로 얻을 수 있지만, 트래픽이 지속적으로 증가하면 언젠가 결국 또 성능 문제가 발생할 수 밖에 없음 → 이 때마다 수직 확장을 반복할 순 없음!
    - 수직 확장은 비용이 많이 듦
    - 한 대의 장비가 감당할 수 있는 용량에도 한계가 있음

- **수평 확장 (scale-out)**
    - 따라서 트래픽이 증가하면 서버를 추가로 투입해 TPS를 높이는 방법도 고려해야함
