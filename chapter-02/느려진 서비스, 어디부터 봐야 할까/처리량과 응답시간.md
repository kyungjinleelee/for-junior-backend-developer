# 처리량과 응답 시간

사용자는 무언가를 실행할 때 동작하기까지 걸린 시간으로 성능을 판단하지만, 실제로는 다양한 지표가 성능과 관련되어 있음. 

(`e.g.` 네트워크 속도, 디스크 속도, 메모리 크기, 디바이스(스마트폰)의 CPU 속도 등..) 

이런 다양한 지표 중에서 **서버 성능과 관련 있는 중요한 지표**를 2가지 꼽자면 **`응답시간`** 과 **`처리량`** 임

## 응답 시간

- **응답 시간**
    - 사용자의 요청을 처리하는 데 걸리는 시간
    - 다음과 같이 2가지로 나누어 측정하기도 한다.
        - **TTFB**(Time to First Byte) : 응답 데이터 중 **첫 번째 바이트**가 도착할 때까지 걸린 시간
        - **TTLB**(Time to Last Byte) : 응답 데이터의 **마지막 바이트**가 도착할 때까지 걸린 시간
    - if 응답 데이터의 크기가 작다면?
        - TTFB와 TTLB의 차이가 크지 않음
    - if 전송할 데이터가 크거나 네트워크 속도가 느리면? (e.g. 파일 다운로드)
        - TTFB와 TTLB의 차이가 커질 수 있음
    - ⇒ 따라서 서버 성능을 올바르게 평가하려면?
        - 데이터 특성이나 네트워크 환경을 고려해 **TTFB나 TTLB 중 적절한 지표를 선택**해 측정하자.

<br>

>
> **응답 시간은 비즈니스에 중요**하다
>
> - 응답 시간이 사업에 주는 영향은 크다.
>    - **100ms 지연** 시: 검색 횟수 0.2% 감소
>    - **400ms 지연** 시: 검색 횟수 0.6% 감소 (by. 구글 조사)
>    - 응답 시간이 100ms 증가할 때마다 매출이 1%씩 감소 (by. 아마존 조사)
> - 지연 시간을 다시 복구한 이후에도 검색 횟수 감소세가 지속됨!!
>    - 응답 시간이 길어질수록 서비스에 부정적인 영향을 주는 것은 확실함
>

<br>

- 응답 시간은 **API 요청 전송 시간**, **서버의 처리 시간**, **API 응답 전송 시간**으로 나뉨
    - 서버 개발자는 주로 **서버의 처리 시간**을 확인함
        - 로직 수행 (if, for 등)
        - DB 연동 (SQL 실행)
        - 외부 API 연동
        - 응답 데이터 생성 (전송)

- **Q.** **서버 처리 시간**에 가장 큰 비중을 차지하는 요소는?
- **A.**  **`DB 연동`** 과 **`외부 API`** 연동
    
    <aside>
   
   > 
   > 저자가 경험한 서비스에서 실제 한 요청의 처리 시간을 측정한 결과
   > 
   > - 전체 처리 시간: 348ms
   > - API 연동 1 (외부 네트워크에 존재하는 API 호출) : 186ms (**`53%`**)
   > - API 연동 2 (내부 네트워크에 존재하는 API 호출) : 44ms (`13%`)
   > - DB 연동 (SQL 실행 6회) : 101ms (**`29%`**)
   > - 로직 수행: 17ms (`5%`)
   > </aside>
    
  - API 연동이 없는 경우라면 DB 연동이 전체 실행 시간의 70~80% 이상을 차지함
  - ⇒ **응답 시간을 줄일 땐 DB 연동과 API 연동 시간에 집중**하자.

<br>

## 처리량

위에서 응답 시간의 증가는 사용자 이탈로 이어질 수 있다고 했음. 이를 방지하기 위해선 하단의 2가지 방법을 고려해야 함. 

- = TPS 높일 수 있는 방법
    - 서버가 동시에 처리할 수 있는 요청 수를 늘려 대기 시간 줄이기
    - 처리 시간 자체를 줄여 대시 시간 줄이기

성능을 개선하려면 먼저 현재 서버의 **TPS**와 **응답 시간**을 알아야 함. 즉, 막연히 성능이 느리다고 이것저것 시도하면 안 됨.

- 트래픽이 많은 시간대의 TPS와 응답 시간이 얼마인지 측정하고,
- 이 결과를 바탕으로 목표 TPS와 응답 시간을 설정하고 효과적인 성능 개선안을 도출하면 됨
    - 어떻게? 모니터링 시스템을 통해서!
    - 엘라스틱서치, 스카우터, 핀포인트 같은 도구를 사용하면 실시간 TPS 뿐 아니라 과거 특정 시점의 TPS도 확인할 수 있음
 
자세한 성능 개선 방법은 다음 장에서!
